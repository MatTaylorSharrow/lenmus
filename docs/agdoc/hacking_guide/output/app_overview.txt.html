
<html>
<head>
<title>Application overview and main control flow</title>
<meta http-equiv="Content-Type" content="text/html" />
<link rel="stylesheet" type="text/css" href="screen3.css" type="text/css" />
</head>
<body>




<h1 class='article'>Application overview and main control flow
</h1>

<p class="copyright">
LenMus project (http://www.lenmus.org/)<br />
<a href="#legal_notice">GNU Free Documentation License</a>
</p>


<a name="TOC">&nbsp;</a><p class='toc'>Table of contents</p><p><a class='toc_level1' href='index.txt.html'>Hacking guide main TOC</a></p>
    <a class='toc_level1' href="#toc0001">The application object (class lmTheApp)</a>
    <a class='toc_level1' href="#toc0002">The main frame window (class lmMainFrame)</a>

 


<h2 class='article'><a name="toc0001"></a>The application object (class lmTheApp)</h2>




<p class='justified'>All classes related to related to the main GUI and the MVC model are in folder <i>app</i>.</p>

<p class='justified'>The main class is <span class="kw1">lmTheApp</span> (in files app/TheApp.h &amp; .cpp). It represents the lenmus application itself. Execution of the program starts in method <span class="kw1">OnInit()</span>. In this method, after several initializations, the work starts by creating the document manager (an object of class <span class="kw1">wxDocManager</span>; see wxWidgets documentation). The document manager is part of the MVC model and is responsible for relating documents (Models) to their Views.</p>

<p class='justified'>Then, it proceeds to create the Splash window and the main frame of the application. In order to support dynamically changing the language, the creation of the main frame is encapsulated in method <span class="kw1">RecreateGUI()</span>.</p>

<p class='justified'>After the main frame is created an visible, some additional initializations takes place, the Welcome windows is opened and, if enabled, proceeds to check for available program updates. After all this initializations, method <span class="kw1">lmTheApp::OnInit()</span> finishes, and the application enters in the main event processing loop, waiting for events and dispatching them as they arrive.</p>

<p class='justified'>The normal source of events, at this point, is user interaction with the main frame window.</p>



<h2 class='article'><a name="toc0002"></a>The main frame window (class lmMainFrame)</h2>



<p class='justified'>The main frame window is modelled by class <span class="kw1">lmMainFrame</span> (in files app/MainFrame.h &amp; .cpp). It manages the main window of the application.</p>

<p class='justified'>At creation time (class constructor) it creates the main menu and the status bar. The constructor is invoked from method <span class="kw1">lmTheApp::RecreateGUI()</span>. The, this method invokes <span class="kw1">lmMainFrame::CreateControls()</span> to create all other windows inside the main frame: the toolbar and the notebook window to be used to display the welcome window, the scores to edit and the eBooks. The management of all this windows is done by class <span class="kw1">wxAUI</span>. This class is framework to manage all user interface (AUI stands for Advanced User Interface. See wxWidgets documentation).</p>

<p class='justified'>The important thing to know is not how wxAUI works, but that the main window is a notebook implementing the MDI model (Multiple Document Interface). To adapt the wxWidgets MDI model (similar to MS Windows model: each document view is open in an independent windows, and all view windows are enclosed and restricted to be inside a main windows) to a notebook MDI model (each View is a tab in a notebook) some modifications had to be done. All the code for this is enclose in files contained in folder <i>mdi</i>: mdi/DocViewMIDI.h &amp; .cpp, mdi/ParentFrame.h &amp; .cpp, mdi/ChildFrame.h &amp; .cpp, mdi/ClientWindow.h &amp; .cpp.</p>

<p class='justified'>Again, the knowledge of all these classes and how do they work is irrelevant, unless you are going to hack something related to all this.</p>

<p class='justified'>The most important think to know about <span class="kw1">lmMainFrame</span> class is that it deals with all user interaction. Each time the user clicks on a menu item or in a toolbar button, an event is generated and the event is processes in a method in <span class="kw1">lmMainFrame</span>. For example, when user press button &#039;Play&#039; to play back an score, an event with id &#145;MENU_Play_Start&#146; is generated and this event is processed by method <span class="kw1">lmMainFrame::OnPlayStart()</span>.</p> 

<p class='justified'>Most event identifiers are defined at the beginning of file app/MainFrame.cpp, in an <i>enum</i>  (<b>At this point I recommend you to open MainFrame.cpp file and explore the code as you read this description</b>). The event handler methods that will process those events are defined in the events table (macro <span class="kw1">BEGIN_EVENT_TABLE</span>) immediately after this enum.</p>

<p class='justified'>Continuing with the &#039;Play&#039; button example, method <span class="kw1">lmMainFrame::OnPlayStart()</span> takes control. There, it is just an issue of getting the currently displayed score and asking it to play back itself. This is the way most events are processed: The main frame identifies the currently active view or the relevant score passes the process to it. Explore other event handler methods to get see how control flow is re-directed to the appropriate object.</p>

<p class='justified'>From this point, all knowledge about how thinks work is distributed along the different classes and objects that form the program. But the MVC model and the <span class="kw1">lmMainFrame</span> class are the keys to quickly identify where the action is taking place.
</p>

<hr class='copyright' />
<a name="legal_notice">&nbsp;</a>
<p class="copyright">
Copyright &copy; 2008-2009 LenMus project
</p>
<p class="justified">
This document is part of the LenMus project. 
Permission is granted to copy, distribute and/or modify this
document under the terms of the <a href='http://www.gnu.org/licenses/fdl.html'>GNU Free Documentation License</a>,
Version 1.3 or any later version published by the Free Software
Foundation; with no Invariant Sections, no Front-Cover Texts and
no Back-Cover Texts.  A copy of the license is included with the program.
</p>

</body></html>
