
<html>
<head>
<title>Beamed groups of notes</title>
<meta http-equiv="Content-Type" content="text/html" />
<link rel="stylesheet" type="text/css" href="screen3.css" type="text/css" />
</head>
<body>




<h1 class='article'>Beamed groups of notes
<span class="subtitle"><BR/>How to determine beam info automatically</span></h1>

<p class="copyright">
LenMus project (http://www.lenmus.org/)<br />
<a href="#legal_notice">GNU Free Documentation License</a>
</p>



<a name="TOC">&nbsp;</a><p class='toc'>Table of contents</p><p><a class='toc_level1' href='index.txt.html'>Hacking guide main TOC</a></p>
    <a class='toc_level1' href="#toc0001">Purpose</a>
        <a class='toc_level2' href="#toc0002">Beam types</a>
    <a class='toc_level1' href="#toc0003">Algorithm</a>
    <a class='toc_level1' href="#toc0004">Test cases</a>




<h2 class='article'><a name="toc0001"></a>Purpose</h2>


<p class='justified'>When entering notes, the program should take care of grouping notes appropriately to show clearly the underlying metric organization. This document describes the algorithm to compute, for each note in a beamed group, the type of beam to assign to each beam level. The algorithm is implemented in file <CODE>Beam.cpp</CODE>, in method <CODE>lmBeam::AutoSetUp()</CODE>.</p>


<h3 class='article'><a name="toc0002"></a>Beam types</h3>


<p class='justified'>The number of levels required by a note depends on its duration. As the shortest note is a 256th, it is enough to have six beam levels, as shown in following table:</p>


<A name="table1"><B></B></A><p>&nbsp;</p><table class="simpletable">
<th class="simpletable">Note type</th><th class="simpletable">Num levels</th>
<tr class="simpletable"><td class="simpletable">eighth (e)</td><td class="simpletable" style="text-align:center">1</td></tr>
<tr class="simpletable"><td class="simpletable">16th (s)</td><td class="simpletable" style="text-align:center">2</td></tr>
<tr class="simpletable"><td class="simpletable">32nd (t)</td><td class="simpletable" style="text-align:center">3</td></tr>
<tr class="simpletable"><td class="simpletable">64th (x)</td><td class="simpletable" style="text-align:center">4</td></tr>
<tr class="simpletable"><td class="simpletable">128th</td><td class="simpletable" style="text-align:center">5</td></tr>
<tr class="simpletable"><td class="simpletable">256th</td><td class="simpletable" style="text-align:center">6</td></tr>
</table><center><p><FONT style="margin-left:1em"><I>Table 1. Levels required by a note</I></FONT></p></center><p>&nbsp;</p>
    
<p class='justified'>Each note stores information about the type of beam to assign to each beam level. It is one of the following values:</p>

<div class="informalexample"><pre class="programlisting">
enum lmEBeamType {
    eBeamNone = 0,  //No beam
    eBeamBegin,     //Start of beam in this note
    eBeamContinue,  //Continue a beam
    eBeamEnd,       //Finish a beam in this note
    eBeamForward,   //Forward hook
    eBeamBackward   //Backward hook
};
</pre></div>

<center><img class='figure' src='images/beams-auto-setup-figure-1.png' title=' Figure 1: example of group. See text for an explanation. ' /></center><p class='FigureTitle'> Figure 1: example of group. See text for an explanation. </p>

<p class='justified'>For example, the notes in figure 1 will have the following information:</p>

<A name="table1"><B></B></A><p>&nbsp;</p><table class="simpletable">
<th class="simpletable">level</th><th class="simpletable">Note1</th><th class="simpletable">Note2</th><th class="simpletable">Note3</th><th class="simpletable">Note4</th>
<tr class="simpletable"><td class="simpletable" style="text-align:center">1</td><td class="simpletable" style="text-align:center">Begin</td><td class="simpletable" style="text-align:center">Continue</td><td class="simpletable" style="text-align:center">Continue</td><td class="simpletable" style="text-align:center">End</td></tr>
<tr class="simpletable"><td class="simpletable" style="text-align:center">2</td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td><td class="simpletable" style="text-align:center">Begin</td><td class="simpletable" style="text-align:center">Continue</td><td class="simpletable" style="text-align:center">End</td></tr>
<tr class="simpletable"><td class="simpletable" style="text-align:center">3</td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td><td class="simpletable" style="text-align:center">Forward</td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td><td class="simpletable" style="text-align:center">Backward</td></tr>
<tr class="simpletable"><td class="simpletable" style="text-align:center">4</td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td></tr>
<tr class="simpletable"><td class="simpletable" style="text-align:center">5</td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td></tr>
<tr class="simpletable"><td class="simpletable" style="text-align:center">6</td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td><td class="simpletable" style="text-align:center"><span class="larger">&#151;</span></td></tr>
</table><center><p><FONT style="margin-left:1em"><I>Table 2. Information about beam levels stored in each note for example in figure 1</I></FONT></p></center><p>&nbsp;</p>
    



<h2 class='article'><a name="toc0003"></a>Algorithm</h2>


<p class='justified'>First thing to note is that beaming information, at one level, is independent of beaming information at the other levels. Therefore, the algorithm is a loop to compute, in sequence, each beam level.</p>
                                    
<p class='justified'>We will denote Level(i) as the number of levels for note number i. This number only depends on note duration, as stated in table 1.</p>

<p class='justified'>The algorithm is as follows:</p>

<div class="informalexample"><pre class="programlisting">
<b>for</b> CurLevel := 1 to 6
    <b>for</b> i := 1 to NumNotes
        //If current level is greater than level of Note<SUB>i</SUB> set beam to None
        <b>if</b> CurLevel &gt; Level(i) <span class="larger">&#8594;</span> None         <b>Rule [0]</b> 

        <b>else</b>
            Classify Note<SUB>i</SUB> as <i>First</i>, <i>Intermediate</i>, or <i>Final</i> and 
            apply the following rules:

            1) <b>Case</b> <i>First</i> note:                             
                <b>if</b> CurLevel &gt; Level(i+1) <span class="larger">&#8594;</span> Forward hook   <b>Rule [1.1]</b>
                <b>else</b>                     <span class="larger">&#8594;</span> Begin          <b>Rule [1.2]</b>

            2) <b>Case</b> <i>Intermediate</i> note:
                <b>if</b> CurLevel &lt; Level(i)            
                  <b>if</b> CurLevel &gt; Level(i+1) <span class="larger">&#8594;</span> End       <b>Rule [2.1a]</b>
                  <b>else</b>                     <span class="larger">&#8594;</span> Continue  <b>Rule [2.1b]</b>

                <b>else if</b> CurLevel &gt; Level(i-1)
                  <b>if</b>CurLevel &gt; Level(i+1) <span class="larger">&#8594;</span> Hook (fwd or bwd)  <b>Rule [2.2a]</b>
                  <b>else</b>                  <span class="larger">&#8594;</span> Begin                <b>Rule [2.2b]</b>

                <b>else</b> [CurLevel &lt;= Level(i-1)]
                  <b>if</b> CurLevel &gt; Level(i+1) <span class="larger">&#8594;</span> End           <b>Rule [2.3a]</b>
                  <b>else</b>                     <span class="larger">&#8594;</span> Continue      <b>Rule [2.3b]</b>

            3) <b>Case</b> <i>Final</i> note:
                <b>if</b> CurLevel &lt;= Level(i-1) <span class="larger">&#8594;</span> End             <b>Rule [3.1]</b>
                <b>else</b>                      <span class="larger">&#8594;</span> Backward hook   <b>Rule [3.2]</b>

    <b>end for</b>
<b>end for</b>
</pre></div>

<p class='justified'>From the set of rules in the algorithm it is possible to build the logical functions for each type of beam. But the resulting logical functions are complex and, therefore, its evaluation will need more instructions and processing time than a direct application of the different rules. Therefore, implementation has been done by sequential evaluation of the rules as depicted in the algorithm description.</p>

<p class='justified'>The algorithm is implemented in file <CODE>Beam.cpp</CODE>, in method <CODE>lmBeam::AutoSetUp()</CODE>.</p>


<h2 class='article'><a name="toc0004"></a>Test cases</h2>


<p class='justified'>Regression tests:</p>

<center><img class='figure' src='images/file_004.20_beams.lms.png' title=' Test file: 004.20_beams.lms ' /></center><p class='FigureTitle'> Test file: 004.20_beams.lms </p>



<p class='justified'></p>



<hr class='copyright' />
<a name="legal_notice">&nbsp;</a>
<p class="copyright">
Copyright &copy; 2008-2009 LenMus project
</p>
<p class="justified">
This document is part of the LenMus project. 
Permission is granted to copy, distribute and/or modify this
document under the terms of the <a href='http://www.gnu.org/licenses/fdl.html'>GNU Free Documentation License</a>,
Version 1.3 or any later version published by the Free Software
Foundation; with no Invariant Sections, no Front-Cover Texts and
no Back-Cover Texts.  A copy of the license is included with the program.
</p>

</body></html>
